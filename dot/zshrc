# Created by newuser for 4.3.17
fpath=(~/.zsh/completion $fpath)

export PATH=/home/olivier/.local/bin:$PATH

#source ~/Projects/zsh-git-prompt/zshrc.sh
#source ~/Projects/liquidprompt/liquidprompt
#PROMPT='%{'$'\033[01;32m%}%n@%B%m%{\033[00m%} %{\033[01;33m%}%~%{\033[00m%}%b$(git_super_status)%{\033[00m%} '

# History option
setopt INC_APPEND_HISTORY
setopt histignorealldups sharehistory
# Keep 100000 lines of history within the shell and save it to ~/.zsh_history:
HISTSIZE=100000
SAVEHIST=100000
HISTFILE=~/.zsh_history

# general
export EDITOR=vim
alias o="xdg-open"
alias reload="source ~/.zshrc"
alias autube="youtube-dl -x"
alias ls='ls --color=auto'
alias l="ls -lh"
alias taupe="netstat -taupe"
alias c="cd .."
alias cc="cd ../.."
alias ccc="cd ../../.."
alias cccc="cd ../../../.."


# ANTIGEN: Zsh package manager
source $HOME/dotfiles/antigen.zsh
antigen bundle zsh-users/zsh-syntax-highlighting
antigen bundle nojhan/liquidprompt
antigen bundle zsh-users/zsh-completions src
antigen apply


alias m="python manage.py"
alias as="apt-cache search"
alias ai="sudo apt-get install"
alias apt="sudo apt"
alias attach="sudo lxc-attach -n"
alias wiki="vim -c :VimwikiIndex"
alias meteo='curl http://wttr.in/bruxelles'
alias td=qtodotxt2
alias vw='vim -c VimwikiIndex'

# Insert Google DNS in resolv.conf
alias gdns="sudo sh -c 'echo nameserver 8.8.8.8 > /etc/resolv.conf'"

# set up PIP Download cache so it won't reload the package
export PIP_DOWNLOAD_CACHE=$HOME/.cache/pip


## Let a bunch of app configure themselves
# For proper color output in ls
eval "$(dircolors -b)"

# FZF for fuzzy
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# Lesspipe (convert binary output unreadable by less
[ -x /usr/bin/lesspipe ] && eval "$(lesspipe)"

# Virtualenvwrapper
export WORKON_HOME=$HOME/.virtualenvs
export PROJECT_HOME=$HOME/Projects #used by mkproject (of virtualenvwrapper)
#source /etc/bash_completion.d/virtualenvwrapper
# Conditionaly load in case it's not installed
[ -f /usr/share/virtualenvwrapper/virtualenvwrapper_lazy.sh ] && source /usr/share/virtualenvwrapper/virtualenvwrapper_lazy.sh
# list virtualenv  (manager by venvwrapper) without all the dumb output of lsvirtualenvs
alias lsve="find ~/.virtualenvs  -maxdepth 1 -mindepth 1 -type d  -printf '%f\\n'|sort"


# Autocompletion
autoload -Uz compinit
compinit
zstyle ':completion:*:default' list-colors ${(s.:.)LS_COLORS}
zstyle ':completion:*' list-colors ''
zstyle ':completion:*' max-errors 3 numeric
zstyle ':completion:*' list-prompt %SAt %p: Hit TAB for more, or the character to insert%s
zstyle ':completion:*' matcher-list '' 'm:{a-z}={A-Z}' 'm:{a-zA-Z}={A-Za-z}' 'r:|[._-]=* r:|=* l:|=*'
zstyle ':completion:*' menu select=long
zstyle ':completion:*' select-prompt %SScrolling active: current selection at %p%s
zstyle ':completion:*' use-compctl false
zstyle ':completion:*' verbose true

zstyle ':completion:*:*:kill:*:processes' list-colors '=(#b) #([0-9]#)*=0=01;31'
zstyle ':completion:*:kill:*' command 'ps -u $USER -o pid,%cpu,tty,cputime,cmd'
#
# Taken from debian default .zsh not sure what it does yet
zstyle ':completion:*' auto-description 'specify: %d'
zstyle ':completion:*' completer _expand _complete _correct _approximate
zstyle ':completion:*' format 'Completing %d'
zstyle ':completion:*' group-name ''
zstyle ':completion:*' menu select=2


#  WORK and Development
alias fakesmtp="/usr/bin/python -m smtpd -n -c DebuggingServer localhost:4025"
# left for exemple
# alias snr="/home/olivier/.virtualenvs/sn/bin/python /home/olivier/Projects/Supernova/manage.py runserver 8001"
# vpn
# alias vpn="cd ~/.certs/newvpn && sudo openvpn rn-vpn.conf"
#alias dbpwreset="psql -c \"update res_users set password ='admin';\""
# retrievedb() {
#    lftp -c "open sftp://bkp@sabayon.railnova.eu; get bkp@donut.railnova.eu/$1/DAILY/LAST.dump -o ~/Projects/dumps/$1-$(date -I).dump"
# }

alias dbsize="psql postgres -c \"select datname, pg_size_pretty(pg_database_size(datname)) as size from pg_database order by pg_database_size(datname) desc;\""

dbrestore() {
    pg_restore -d postgres --create -x -O  $1

}

#alias irc="echo -en \"\033]0;chat\a\"; ssh staz@server.staz.be -t screen -RDU pts-7; echo -en \"\033]0;Terminal\a\""
alias irc="echo -en \"\033]0;chat\a\"; autossh olivier@server.staz.be -t tmux attach; echo -en \"\033]0;Terminal\a\""
alias q="echo -en \"\033]0;/tmp/q\a\"; touch /tmp/q; tail -f /tmp/q; echo -en \"\033]0;Terminal\a\""
alias shell='sudo -u django /home/django/Supernova/venv/bin/python /home/django/Supernova/manage.py shell_plus'

# git help
function gcm() { git commit -m "$(echo $*)";}
function git-current-branch() {
    git rev-parse --abbrev-ref HEAD
}

# push and set upstream
function gpp(){
    git push --set-upstream origin $(git-current-branch)
}


# For python developement, jump into module
cdp () {
    cd "$(python -c "import os.path as _, ${1}; \
            print(_.dirname(_.realpath(${1}.__file__[:-1])))"
        )"
}

# Ctrl-Z will now bring back the app
fancy-ctrl-z () {
  if [[ $#BUFFER -eq 0 ]]; then
    BUFFER="fg"
    zle accept-line
  else
    zle push-input
    zle clear-screen
  fi
}
zle -N fancy-ctrl-z
bindkey '^Z' fancy-ctrl-z


# Control the tab title in the terminal application
title() {
    echo -en "\033]0;$*\a";
}
resettitle() {
    echo -en \"\033]0;Terminal\a\";
}

# SSH a host, change the tab title and tmux attach
tssh(){
    echo -en "\033]0;$*\a";
    /usr/bin/ssh -t $@ "tmux attach || tmux new";
    echo -en "\033]0;Terminal\a";
}
# Idem with autossh instead
ta(){
    echo -en "\033]0;$*\a";
    /usr/bin/autossh -t $@ "tmux attach || tmux new";
    echo -en "\033]0;Terminal\a";
}


# Filebrowser
# support for nnn see https://github.com/jarun/nnn#quickstart
export NNN_TMPFILE="/tmp/nnn"
export NNN_FALLBACK_OPENER=xdg-open

n()
{
        nnn "$@"

        if [ -f $NNN_TMPFILE ]; then
                . $NNN_TMPFILE
                rm $NNN_TMPFILE
        fi
}

# Retire / de la definition des mots, ainsi quand on fait ctrl-w ca vire pas tout un path
# https://unix.stackexchange.com/questions/48577/modifying-the-zsh-shell-word-split
export WORDCHARS=$WORDCHARS:s:/:

# For android developement for Sailsense
export ANDROID_HOME=$HOME/Projects/sailsense/android-sdk
export PATH=$PATH:$ANDROID_HOME/emulator
export PATH=$PATH:$ANDROID_HOME/tools
export PATH=$PATH:$ANDROID_HOME/tools/bin
export PATH=$PATH:$ANDROID_HOME/platform-tools


help()
{
    echo "A start of help"
    echo "Commands:"
    echo " n for a file browser"
    echo " fc to edit last command in vim"
    echo ""
    echo "Keyboard shortcuts:"
    echo " Ctrl-z to do fg"
    echo " Ctrl-r to history search with fzf"
    echo " Ctrl-t to find file with fzf"
    echo " Alt-C cd into directory with fzf"
    echo " Alt-. take args from last command"
}
